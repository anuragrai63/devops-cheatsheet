<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kubernetes Storage: The Visual Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F8FAFC; color: #1E293B; }
        
        /* Chart Container Standards */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container { height: 350px; }
        }

        /* Custom Utilities for Diagrams (No SVG/Mermaid) */
        .flow-arrow::after {
            content: '▼';
            display: block;
            text-align: center;
            color: #6366F1; /* Indigo-500 */
            font-size: 1.5rem;
            margin-top: -0.5rem;
            margin-bottom: -0.5rem;
        }
        .flow-arrow-horizontal::after {
            content: '▶';
            display: inline-block;
            color: #6366F1;
            font-size: 1.5rem;
            margin: 0 10px;
        }
        
        /* Card Hover Effects */
        .hover-lift { transition: transform 0.2s, box-shadow 0.2s; }
        .hover-lift:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }

        /* Code Block Styling - UPDATED FOR PRESERVED WHITESPACE */
        .yaml-block {
            font-family: 'Courier New', Courier, monospace;
            background-color: #1E293B; /* Slate-800 */
            color: #E2E8F0; /* Slate-200 */
            padding: 1rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            line-height: 1.4;
            overflow-x: auto;
            border-left: 4px solid #6366F1;
            white-space: pre; /* Critical for YAML indentation */
            max-height: 300px;
            overflow-y: auto;
        }
        .yaml-comment { color: #94A3B8; font-style: italic; }
        .yaml-key { color: #38BDF8; } /* Sky-400 */
        .yaml-val { color: #A5B4FC; } /* Indigo-300 */
        
        .cmd-block {
            font-family: 'Courier New', Courier, monospace;
            background-color: #0F172A; 
            color: #4ADE80; /* Green-400 */
            padding: 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            border: 1px solid #334155;
            margin-top: 0.5rem;
            white-space: pre-wrap; /* Allows wrapping for long commands */
        }

        /* Palette: Vibrant & Tech-Focused */
        /* Primary: #4F46E5 (Indigo), Secondary: #06B6D4 (Cyan), Accent: #D946EF (Fuchsia) */
    </style>
</head>
<body class="overflow-x-hidden">

    <!-- HEADER SECTION -->
    <header class="bg-gradient-to-r from-indigo-600 to-cyan-500 text-white py-16 px-4 shadow-lg">
        <div class="max-w-6xl mx-auto text-center">
            <h1 class="text-5xl md:text-6xl font-extrabold mb-6 tracking-tight">Kubernetes Storage</h1>
            <p class="text-xl md:text-2xl font-light opacity-90 max-w-3xl mx-auto">
                A visual masterclass on Volumes, Persistent Claims, Dynamic Provisioning, and the CSI ecosystem.
            </p>
            <div class="mt-8 flex justify-center space-x-4 flex-wrap gap-2">
                <span class="bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-sm font-semibold">PV & PVC</span>
                <span class="bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-sm font-semibold">ConfigMap</span>
                <span class="bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-sm font-semibold">Snapshots</span>
                <span class="bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-sm font-semibold">Attributes Class</span>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-12 space-y-20">

        <!-- SECTION 1: THE STORAGE SPECTRUM -->
        <section>
            <div class="mb-8 border-l-8 border-indigo-500 pl-6">
                <h2 class="text-3xl font-bold text-gray-800">1. The Storage Spectrum</h2>
                <p class="mt-2 text-lg text-gray-600">
                    Choosing the right volume type: From ephemeral scratch space to projected configurations.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                
                <!-- 1. Ephemeral (EmptyDir) -->
                <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-cyan-400 hover-lift">
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Ephemeral: emptyDir</h3>
                    <p class="text-gray-600 mb-2 text-xs">Lifecycle tied to Pod. Good for scratch space/cache.</p>
                    <div class="yaml-block"><span class="yaml-key">apiVersion:</span> <span class="yaml-val">v1</span>
<span class="yaml-key">kind:</span> <span class="yaml-val">Pod</span>
<span class="yaml-key">metadata:</span>
  <span class="yaml-key">name:</span> <span class="yaml-val">test-emptydir</span>
<span class="yaml-key">spec:</span>
  <span class="yaml-key">containers:</span>
  - <span class="yaml-key">image:</span> <span class="yaml-val">nginx</span>
    <span class="yaml-key">name:</span> <span class="yaml-val">test-container</span>
    <span class="yaml-key">volumeMounts:</span>
    - <span class="yaml-key">mountPath:</span> <span class="yaml-val">/cache</span>
      <span class="yaml-key">name:</span> <span class="yaml-val">cache-volume</span>
  <span class="yaml-key">volumes:</span>
  - <span class="yaml-key">name:</span> <span class="yaml-val">cache-volume</span>
    <span class="yaml-key">emptyDir:</span> <span class="yaml-val">{}</span></div>
                </div>

                <!-- 2. Projected Volumes -->
                <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-fuchsia-500 hover-lift">
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Projected Volumes</h3>
                    <p class="text-gray-600 mb-2 text-xs">Map multiple sources (Secrets, ConfigMaps) to one path.</p>
                    <div class="yaml-block"><span class="yaml-key">volumes:</span>
  - <span class="yaml-key">name:</span> <span class="yaml-val">all-in-one</span>
    <span class="yaml-key">projected:</span>
      <span class="yaml-key">sources:</span>
      - <span class="yaml-key">secret:</span>
          <span class="yaml-key">name:</span> <span class="yaml-val">my-secret</span>
      - <span class="yaml-key">configMap:</span>
          <span class="yaml-key">name:</span> <span class="yaml-val">my-configmap</span>
      - <span class="yaml-key">downwardAPI:</span>
          <span class="yaml-key">items:</span>
            - <span class="yaml-key">path:</span> <span class="yaml-val">"labels"</span>
              <span class="yaml-key">fieldRef:</span>
                <span class="yaml-key">fieldPath:</span> <span class="yaml-val">metadata.labels</span></div>
                </div>

                <!-- 3. Generic Ephemeral -->
                <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-indigo-600 hover-lift">
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Generic Ephemeral</h3>
                    <p class="text-gray-600 mb-2 text-xs">Per-pod PVCs. Scratch space with StorageClass features.</p>
                    <div class="yaml-block"><span class="yaml-key">volumes:</span>
  - <span class="yaml-key">name:</span> <span class="yaml-val">scratch-volume</span>
    <span class="yaml-key">ephemeral:</span>
      <span class="yaml-key">volumeClaimTemplate:</span>
        <span class="yaml-key">spec:</span>
          <span class="yaml-key">accessModes:</span> <span class="yaml-val">[ "ReadWriteOnce" ]</span>
          <span class="yaml-key">storageClassName:</span> <span class="yaml-val">"fast-local"</span>
          <span class="yaml-key">resources:</span>
            <span class="yaml-key">requests:</span>
              <span class="yaml-key">storage:</span> <span class="yaml-val">1Gi</span></div>
                </div>
            </div>

            <!-- Volume Usage Chart -->
            <div class="mt-8 bg-white p-6 rounded-xl shadow-lg flex flex-col justify-center max-w-4xl mx-auto border-t-4 border-gray-400">
                <h4 class="text-center font-bold text-gray-700 mb-4">Common Volume Strategy Distribution</h4>
                <div class="chart-container">
                    <canvas id="volumeTypesChart"></canvas>
                </div>
            </div>
        </section>

        <!-- SECTION 2: PROVISIONING ARCHITECTURE (UPDATED DETAILED FLOWS) -->
        <section class="bg-indigo-50 rounded-3xl p-8 md:p-12">
            <div class="mb-10 text-center">
                <h2 class="text-3xl font-bold text-indigo-900">2. Provisioning Architecture</h2>
                <p class="mt-4 text-indigo-700 max-w-3xl mx-auto">
                    A deep dive into the complete object lifecycle for both Static and Dynamic workflows.
                </p>
            </div>

            <!-- METHOD A: STATIC PROVISIONING DETAIL -->
            <div class="mb-12 bg-white p-6 rounded-2xl shadow-xl border border-gray-300">
                <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                    <span class="bg-gray-200 text-gray-700 px-3 py-1 rounded-lg mr-3 text-lg">A</span> 
                    Static Provisioning (Manual)
                </h3>
                <p class="mb-6 text-gray-600 text-sm">
                    In this flow, the administrator is responsible for pre-provisioning the storage and the PV. The user only matches against the storage class and capacity.
                </p>
                
                <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 relative">
                    <!-- Step 1: StorageClass -->
                    <div class="relative">
                        <div class="absolute -top-3 left-4 bg-gray-700 text-white px-2 py-0.5 rounded text-xs font-bold z-10">Step 1: Admin defines Class</div>
                        <div class="yaml-block h-full"><span class="yaml-comment"># 1. StorageClass (Manual)</span>
<span class="yaml-key">apiVersion:</span> <span class="yaml-val">storage.k8s.io/v1</span>
<span class="yaml-key">kind:</span> <span class="yaml-val">StorageClass</span>
<span class="yaml-key">metadata:</span>
  <span class="yaml-key">name:</span> <span class="yaml-val">manual</span>
<span class="yaml-key">provisioner:</span> <span class="yaml-val">kubernetes.io/no-provisioner</span>
<span class="yaml-key">volumeBindingMode:</span> <span class="yaml-val">WaitForFirstConsumer</span></div>
                    </div>

                    <!-- Arrow for Desktop -->
                    <div class="hidden xl:block absolute top-1/2 left-[32%] text-gray-300 text-2xl -translate-y-1/2 z-20">▶</div>

                    <!-- Step 2: PV -->
                    <div class="relative">
                        <div class="absolute -top-3 left-4 bg-gray-700 text-white px-2 py-0.5 rounded text-xs font-bold z-10">Step 2: Admin creates PV</div>
                        <div class="yaml-block h-full"><span class="yaml-comment"># 2. PersistentVolume</span>
<span class="yaml-key">apiVersion:</span> <span class="yaml-val">v1</span>
<span class="yaml-key">kind:</span> <span class="yaml-val">PersistentVolume</span>
<span class="yaml-key">metadata:</span>
  <span class="yaml-key">name:</span> <span class="yaml-val">nfs-pv</span>
<span class="yaml-key">spec:</span>
  <span class="yaml-key">capacity:</span>
    <span class="yaml-key">storage:</span> <span class="yaml-val">5Gi</span>
  <span class="yaml-key">accessModes:</span>
    - <span class="yaml-val">ReadWriteMany</span>
  <span class="yaml-key">storageClassName:</span> <span class="yaml-val">manual</span>
  <span class="yaml-key">nfs:</span>
    <span class="yaml-key">path:</span> <span class="yaml-val">/srv/nfs/kubedata</span>
    <span class="yaml-key">server:</span> <span class="yaml-val">10.0.0.5</span></div>
                    </div>

                    <!-- Arrow for Desktop -->
                    <div class="hidden xl:block absolute top-1/2 left-[65%] text-gray-300 text-2xl -translate-y-1/2 z-20">▶</div>

                    <!-- Step 3: PVC -->
                    <div class="relative">
                        <div class="absolute -top-3 left-4 bg-green-600 text-white px-2 py-0.5 rounded text-xs font-bold z-10">Step 3: User Request (PVC)</div>
                        <div class="yaml-block h-full"><span class="yaml-comment"># 3. PersistentVolumeClaim</span>
<span class="yaml-key">apiVersion:</span> <span class="yaml-val">v1</span>
<span class="yaml-key">kind:</span> <span class="yaml-val">PersistentVolumeClaim</span>
<span class="yaml-key">metadata:</span>
  <span class="yaml-key">name:</span> <span class="yaml-val">nfs-pvc</span>
<span class="yaml-key">spec:</span>
  <span class="yaml-key">storageClassName:</span> <span class="yaml-val">manual</span>
  <span class="yaml-key">accessModes:</span>
    - <span class="yaml-val">ReadWriteMany</span>
  <span class="yaml-key">resources:</span>
    <span class="yaml-key">requests:</span>
      <span class="yaml-key">storage:</span> <span class="yaml-val">2Gi</span></div>
                    </div>
                </div>
            </div>

            <!-- METHOD B: DYNAMIC PROVISIONING DETAIL -->
            <div class="mb-12 bg-white p-6 rounded-2xl shadow-xl border border-indigo-400">
                <h3 class="text-2xl font-bold text-indigo-900 mb-4 flex items-center">
                    <span class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-lg mr-3 text-lg">B</span> 
                    Dynamic Provisioning (Automated)
                </h3>
                <p class="mb-6 text-indigo-800 text-sm">
                    Here, the Admin only sets up the "Template" (StorageClass). The creation of the user's PVC automatically triggers the provisioner to create the PV and physical volume.
                </p>

                <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 relative">
                    <!-- Step 1: StorageClass -->
                    <div class="relative">
                        <div class="absolute -top-3 left-4 bg-indigo-600 text-white px-2 py-0.5 rounded text-xs font-bold z-10">Step 1: Admin defines Template</div>
                        <div class="yaml-block h-full"><span class="yaml-comment"># 1. StorageClass (Template)</span>
<span class="yaml-key">apiVersion:</span> <span class="yaml-val">storage.k8s.io/v1</span>
<span class="yaml-key">kind:</span> <span class="yaml-val">StorageClass</span>
<span class="yaml-key">metadata:</span>
  <span class="yaml-key">name:</span> <span class="yaml-val">fast-ssd</span>
<span class="yaml-key">provisioner:</span> <span class="yaml-val">kubernetes.io/aws-ebs</span>
<span class="yaml-key">parameters:</span>
  <span class="yaml-key">type:</span> <span class="yaml-val">gp3</span>
  <span class="yaml-key">fsType:</span> <span class="yaml-val">ext4</span>
<span class="yaml-key">reclaimPolicy:</span> <span class="yaml-val">Delete</span>
<span class="yaml-key">volumeBindingMode:</span> <span class="yaml-val">WaitForFirstConsumer</span></div>
                    </div>

                    <!-- Arrow for Desktop -->
                    <div class="hidden xl:flex absolute top-1/2 left-[50%] -translate-x-1/2 flex-col items-center justify-center z-20">
                        <span class="bg-indigo-100 text-indigo-700 text-[10px] px-2 py-1 rounded border border-indigo-300 mb-1">References</span>
                        <div class="text-indigo-400 text-3xl">▶</div>
                    </div>

                    <!-- Step 2: PVC -->
                    <div class="relative">
                        <div class="absolute -top-3 left-4 bg-green-600 text-white px-2 py-0.5 rounded text-xs font-bold z-10">Step 2: User Request (PVC)</div>
                        <div class="yaml-block h-full"><span class="yaml-comment"># 2. PersistentVolumeClaim</span>
<span class="yaml-key">apiVersion:</span> <span class="yaml-val">v1</span>
<span class="yaml-key">kind:</span> <span class="yaml-val">PersistentVolumeClaim</span>
<span class="yaml-key">metadata:</span>
  <span class="yaml-key">name:</span> <span class="yaml-val">auto-ebs-pvc</span>
<span class="yaml-key">spec:</span>
  <span class="yaml-key">storageClassName:</span> <span class="yaml-val">fast-ssd</span> <span class="yaml-comment"># &lt;-- Matches SC Name</span>
  <span class="yaml-key">accessModes:</span>
    - <span class="yaml-val">ReadWriteOnce</span>
  <span class="yaml-key">resources:</span>
    <span class="yaml-key">requests:</span>
      <span class="yaml-key">storage:</span> <span class="yaml-val">10Gi</span></div>
                    </div>
                </div>
                
                <div class="mt-4 text-center">
                    <span class="inline-block bg-indigo-50 border border-indigo-200 text-indigo-600 text-xs px-4 py-2 rounded-full">
                        ✨ System Action: Cloud Provider automatically creates a 10Gi GP3 volume and binds it.
                    </span>
                </div>
            </div>

            <!-- The Mount: Pod (Common to both) -->
            <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-teal-500">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg text-teal-700">Final Step: The Mount (Pod)</h3>
                    <span class="text-xs bg-teal-100 text-teal-800 px-2 py-1 rounded">Consumes PVC</span>
                </div>
                <p class="text-sm text-gray-600 mb-4">Regardless of how the PVC was created (Static or Dynamic), the Pod mounts it the same way.</p>
                <div class="yaml-block"><span class="yaml-key">apiVersion:</span> <span class="yaml-val">v1</span>
<span class="yaml-key">kind:</span> <span class="yaml-val">Pod</span>
<span class="yaml-key">metadata:</span>
  <span class="yaml-key">name:</span> <span class="yaml-val">web-server-pod</span>
<span class="yaml-key">spec:</span>
  <span class="yaml-key">containers:</span>
    - <span class="yaml-key">name:</span> <span class="yaml-val">nginx</span>
      <span class="yaml-key">image:</span> <span class="yaml-val">nginx:alpine</span>
      <span class="yaml-key">volumeMounts:</span>       <span class="yaml-comment"># Where to put it</span>
        - <span class="yaml-key">mountPath:</span> <span class="yaml-val">"/usr/share/nginx/html"</span>
          <span class="yaml-key">name:</span> <span class="yaml-val">my-web-storage</span>
  <span class="yaml-key">volumes:</span>                <span class="yaml-comment"># What to use</span>
    - <span class="yaml-key">name:</span> <span class="yaml-val">my-web-storage</span>
      <span class="yaml-key">persistentVolumeClaim:</span>
        <span class="yaml-key">claimName:</span> <span class="yaml-val">nfs-pvc</span> <span class="yaml-comment"># Or auto-ebs-pvc</span></div>
            </div>

        </section>

        <!-- SECTION 3: ACCESS MODES & RECLAIM POLICIES (NEW) -->
        <section class="bg-white rounded-3xl p-8 md:p-12 shadow-xl border border-gray-100">
            <div class="mb-10 text-center">
                <h2 class="text-3xl font-bold text-gray-900">3. Access Modes & Reclaim Policies</h2>
                <p class="mt-4 text-gray-600 max-w-3xl mx-auto">
                    Controlling how pods access storage and what happens to data after deletion.
                </p>
            </div>

            <!-- Access Modes -->
            <h3 class="text-xl font-bold text-indigo-700 mb-6 flex items-center">
                <span class="bg-indigo-100 p-2 rounded mr-3">A</span> Access Modes
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                
                <!-- RWO -->
                <div class="bg-gray-50 p-5 rounded-lg border-t-4 border-indigo-500">
                    <h4 class="font-bold text-gray-800 mb-1">ReadWriteOnce (RWO)</h4>
                    <p class="text-xs text-gray-500 mb-3">Mounted by a single node as read-write.</p>
                    <div class="bg-indigo-50 text-indigo-800 text-xs p-2 rounded mb-3">
                        <strong>Use Case:</strong> Block storage (EBS, PD), Databases (MySQL, Postgres).
                    </div>
                    <div class="yaml-block"><span class="yaml-key">accessModes:</span>
  - <span class="yaml-val">ReadWriteOnce</span></div>
                </div>

                <!-- RWX -->
                <div class="bg-gray-50 p-5 rounded-lg border-t-4 border-cyan-500">
                    <h4 class="font-bold text-gray-800 mb-1">ReadWriteMany (RWX)</h4>
                    <p class="text-xs text-gray-500 mb-3">Mounted by multiple nodes as read-write.</p>
                    <div class="bg-cyan-50 text-cyan-800 text-xs p-2 rounded mb-3">
                        <strong>Use Case:</strong> Shared Filesystems (NFS, EFS, GlusterFS), CMS uploads.
                    </div>
                    <div class="yaml-block"><span class="yaml-key">accessModes:</span>
  - <span class="yaml-val">ReadWriteMany</span></div>
                </div>

                <!-- ROX -->
                <div class="bg-gray-50 p-5 rounded-lg border-t-4 border-fuchsia-500">
                    <h4 class="font-bold text-gray-800 mb-1">ReadOnlyMany (ROX)</h4>
                    <p class="text-xs text-gray-500 mb-3">Mounted by multiple nodes as read-only.</p>
                    <div class="bg-fuchsia-50 text-fuchsia-800 text-xs p-2 rounded mb-3">
                        <strong>Use Case:</strong> Serving static AI models or web assets across a fleet.
                    </div>
                    <div class="yaml-block"><span class="yaml-key">accessModes:</span>
  - <span class="yaml-val">ReadOnlyMany</span></div>
                </div>
            </div>

            <!-- Reclaim Policies -->
            <h3 class="text-xl font-bold text-pink-700 mb-6 flex items-center">
                <span class="bg-pink-100 p-2 rounded mr-3">B</span> Reclaim Policies
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                
                <!-- Retain -->
                <div class="bg-gray-50 p-5 rounded-lg border-l-4 border-yellow-500">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-bold text-gray-800">Retain</h4>
                        <span class="text-[10px] bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full">Safe</span>
                    </div>
                    <p class="text-xs text-gray-600 mb-2">PV is NOT deleted when PVC is removed. Data persists for manual recovery.</p>
                    <div class="yaml-block"><span class="yaml-key">persistentVolumeReclaimPolicy:</span> <span class="yaml-val">Retain</span></div>
                </div>

                <!-- Delete -->
                <div class="bg-gray-50 p-5 rounded-lg border-l-4 border-red-500">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-bold text-gray-800">Delete</h4>
                        <span class="text-[10px] bg-red-100 text-red-800 px-2 py-0.5 rounded-full">Default (Cloud)</span>
                    </div>
                    <p class="text-xs text-gray-600 mb-2">Underlying storage asset (EBS/PD) is automatically deleted with the PVC.</p>
                    <div class="yaml-block"><span class="yaml-key">reclaimPolicy:</span> <span class="yaml-val">Delete</span></div>
                </div>

                <!-- Recycle -->
                <div class="bg-gray-50 p-5 rounded-lg border-l-4 border-gray-400 opacity-80">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-bold text-gray-600">Recycle</h4>
                        <span class="text-[10px] bg-gray-200 text-gray-600 px-2 py-0.5 rounded-full">Deprecated</span>
                    </div>
                    <p class="text-xs text-gray-600 mb-2"> performs <code>rm -rf /volume/*</code>. Replaced by Dynamic Provisioning.</p>
                    <div class="yaml-block"><span class="yaml-key">persistentVolumeReclaimPolicy:</span> <span class="yaml-val">Recycle</span></div>
                </div>

            </div>
        </section>


        <!-- SECTION 4: DATA LIFECYCLE (Snapshots & Clones) -->
        <section>
            <div class="mb-6 border-l-8 border-cyan-500 pl-6">
                <h2 class="text-3xl font-bold text-gray-800">4. Lifecycle & Protection</h2>
                <p class="mt-2 text-lg text-gray-600">
                    Advanced CSI capabilities: Backups (Snapshots) and Data Replication (Cloning).
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Snapshots -->
                <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-fuchsia-500 hover-lift">
                    <h3 class="text-xl font-bold mb-2">Volume Snapshots</h3>
                    <p class="text-sm text-gray-600 mb-4">Point-in-time copy via CSI driver.</p>
                    
                    <div class="space-y-4">
                        <div class="yaml-block"><span class="yaml-comment"># 1. Define the Class</span>
<span class="yaml-key">kind:</span> <span class="yaml-val">VolumeSnapshotClass</span>
<span class="yaml-key">metadata:</span>
  <span class="yaml-key">name:</span> <span class="yaml-val">csi-aws-vsc</span>
<span class="yaml-key">driver:</span> <span class="yaml-val">ebs.csi.aws.com</span>
<span class="yaml-key">deletionPolicy:</span> <span class="yaml-val">Delete</span></div>

                        <div class="yaml-block"><span class="yaml-comment"># 2. Take the Snapshot</span>
<span class="yaml-key">kind:</span> <span class="yaml-val">VolumeSnapshot</span>
<span class="yaml-key">metadata:</span>
  <span class="yaml-key">name:</span> <span class="yaml-val">db-snapshot</span>
<span class="yaml-key">spec:</span>
  <span class="yaml-key">volumeSnapshotClassName:</span> <span class="yaml-val">csi-aws-vsc</span>
  <span class="yaml-key">source:</span>
    <span class="yaml-key">persistentVolumeClaimName:</span> <span class="yaml-val">db-pvc-production</span></div>
                    </div>
                </div>

                <!-- CSI Cloning -->
                <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-cyan-500 hover-lift">
                    <h3 class="text-xl font-bold mb-2">CSI Volume Cloning</h3>
                    <p class="text-sm text-gray-600 mb-4">Create a new PVC from an existing one (Data Population).</p>
                    <div class="yaml-block"><span class="yaml-key">apiVersion:</span> <span class="yaml-val">v1</span>
<span class="yaml-key">kind:</span> <span class="yaml-val">PersistentVolumeClaim</span>
<span class="yaml-key">metadata:</span>
  <span class="yaml-key">name:</span> <span class="yaml-val">db-clone-pvc</span>
<span class="yaml-key">spec:</span>
  <span class="yaml-key">storageClassName:</span> <span class="yaml-val">standard</span>
  <span class="yaml-key">dataSource:</span>
    <span class="yaml-key">name:</span> <span class="yaml-val">db-pvc-production</span> <span class="yaml-comment"># Source PVC</span>
    <span class="yaml-key">kind:</span> <span class="yaml-val">PersistentVolumeClaim</span>
  <span class="yaml-key">accessModes:</span>
    - <span class="yaml-val">ReadWriteOnce</span>
  <span class="yaml-key">resources:</span>
    <span class="yaml-key">requests:</span>
      <span class="yaml-key">storage:</span> <span class="yaml-val">10Gi</span> <span class="yaml-comment"># >= source size</span></div>
                    
                    <div class="mt-4 p-3 bg-blue-50 rounded text-xs text-blue-800 border border-blue-200">
                        <strong>Use Case:</strong> Quickly spinning up a staging database with a copy of production data for debugging.
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 5: PERFORMANCE & ATTRIBUTES -->
        <section>
            <div class="mb-8 border-l-8 border-gray-700 pl-6">
                <h2 class="text-3xl font-bold text-gray-800">5. Performance & Attributes</h2>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Volume Attributes Class -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h4 class="font-bold text-gray-700 mb-2">Volume Attributes Class</h4>
                    <p class="text-xs text-gray-500 mb-4">Modify immutable properties (IOPS/Throughput) dynamically.</p>
                    <div class="yaml-block mb-4"><span class="yaml-key">kind:</span> <span class="yaml-val">VolumeAttributesClass</span>
<span class="yaml-key">metadata:</span>
  <span class="yaml-key">name:</span> <span class="yaml-val">high-iops</span>
<span class="yaml-key">driverName:</span> <span class="yaml-val">ebs.csi.aws.com</span>
<span class="yaml-key">parameters:</span>
  <span class="yaml-key">iops:</span> <span class="yaml-val">"3000"</span>
  <span class="yaml-key">throughput:</span> <span class="yaml-val">"125"</span></div>
                    
                    <div class="text-xs font-bold text-gray-700 mb-1">Imperative Patch:</div>
                    <code class="cmd-block block break-all">kubectl patch pvc my-pvc --type=merge -p '{"spec": {"volumeAttributesClassName": "high-iops"}}'</code>
                </div>

                <!-- IOPS Chart -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h4 class="font-bold text-gray-700 mb-2">Visualizing IOPS Scaling</h4>
                    <div class="chart-container">
                        <canvas id="attributesChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 6: IMPERATIVE COMMAND CHEAT SHEET -->
        <section class="bg-slate-900 rounded-3xl p-8 md:p-12 text-slate-300 shadow-2xl">
            <div class="mb-10 text-center">
                <h2 class="text-3xl font-bold text-white mb-2 flex justify-center items-center gap-3">
                    <span class="text-4xl">⌨️</span> Imperative Command Cheat Sheet
                </h2>
                <p class="text-slate-400">Essential CLI operations for managing, debugging, and inspecting storage.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <!-- 1. General & Inspection -->
                <div class="bg-slate-800 p-5 rounded-lg border border-slate-700">
                    <h3 class="text-lg font-bold text-indigo-400 mb-4 border-b border-slate-600 pb-2">General & Inspection</h3>
                    
                    <div class="mb-4">
                        <div class="text-xs text-white font-bold mb-1">Verify volume mount inside Pod</div>
                        <code class="cmd-block block">kubectl exec -it &lt;pod&gt; -- df -h /cache</code>
                    </div>

                    <div class="mb-4">
                        <div class="text-xs text-white font-bold mb-1">Check Pod details (Volume Config)</div>
                        <code class="cmd-block block">kubectl describe pod &lt;pod&gt;</code>
                    </div>

                    <div class="mb-4">
                        <div class="text-xs text-white font-bold mb-1">List all PVs and PVCs</div>
                        <code class="cmd-block block">kubectl get pv,pvc</code>
                    </div>

                    <div>
                        <div class="text-xs text-white font-bold mb-1">Troubleshoot 'Pending' PVC</div>
                        <code class="cmd-block block">kubectl describe pvc &lt;pvc-name&gt;</code>
                    </div>
                </div>

                <!-- 2. Dynamic Provisioning & Classes -->
                <div class="bg-slate-800 p-5 rounded-lg border border-slate-700">
                    <h3 class="text-lg font-bold text-cyan-400 mb-4 border-b border-slate-600 pb-2">Storage Classes</h3>
                    
                    <div class="mb-4">
                        <div class="text-xs text-white font-bold mb-1">List Storage Classes</div>
                        <code class="cmd-block block">kubectl get sc</code>
                    </div>

                    <div>
                        <div class="text-xs text-white font-bold mb-1">Set Default Storage Class</div>
                        <code class="cmd-block block break-all">kubectl patch storageclass &lt;name&gt; -p '{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}'</code>
                    </div>
                </div>

                <!-- 3. Lifecycle (Snapshots) -->
                <div class="bg-slate-800 p-5 rounded-lg border border-slate-700">
                    <h3 class="text-lg font-bold text-fuchsia-400 mb-4 border-b border-slate-600 pb-2">Snapshots</h3>
                    
                    <div class="mb-4">
                        <div class="text-xs text-white font-bold mb-1">Check Snapshot Status</div>
                        <code class="cmd-block block">kubectl get volumesnapshot</code>
                    </div>

                    <div>
                        <div class="text-xs text-white font-bold mb-1">View Snapshot Details</div>
                        <code class="cmd-block block">kubectl describe volumesnapshot &lt;name&gt;</code>
                    </div>
                </div>

                <!-- 4. Monitoring & Capacity -->
                <div class="bg-slate-800 p-5 rounded-lg border border-slate-700">
                    <h3 class="text-lg font-bold text-green-400 mb-4 border-b border-slate-600 pb-2">Monitoring & Capacity</h3>
                    
                    <div class="mb-4">
                        <div class="text-xs text-white font-bold mb-1">Check Storage Capacity (CSI)</div>
                        <code class="cmd-block block">kubectl get csistoragecapacities -n kube-system</code>
                    </div>

                    <div class="mb-4">
                        <div class="text-xs text-white font-bold mb-1">Check Node Volume Limits</div>
                        <code class="cmd-block block">kubectl get node &lt;node&gt; -o yaml</code>
                        <div class="text-[10px] text-gray-500 mt-1">Look for allocatable.attachable-volumes-*</div>
                    </div>

                    <div>
                        <div class="text-xs text-white font-bold mb-1">Health Check (Events)</div>
                        <code class="cmd-block block">kubectl describe pvc &lt;pvc&gt;</code>
                        <div class="text-[10px] text-gray-500 mt-1">Look for: FileSystemResizeFailed, VolumeMountFailed</div>
                    </div>
                </div>

            </div>
        </section>

    </main>

    <footer class="bg-white py-8 border-t border-gray-200 mt-12">
        <div class="max-w-7xl mx-auto px-4 text-center text-gray-400 text-sm">
            <p>Generated based on Kubernetes Storage Cheat Sheet v1.2</p>
        </div>
    </footer>

    <!-- JAVASCRIPT FOR CHARTS -->
    <script>
        // --- 1. Volume Usage Strategy Chart ---
        const ctxTypes = document.getElementById('volumeTypesChart').getContext('2d');
        new Chart(ctxTypes, {
            type: 'doughnut',
            data: {
                labels: ['Persistent (PVC/EBS)', 'ConfigMap/Secret', 'EmptyDir (Scratch)', 'Generic Ephemeral'],
                datasets: [{
                    data: [40, 25, 20, 15], 
                    backgroundColor: ['#4F46E5', '#D946EF', '#06B6D4', '#94A3B8'],
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            },
            options: {
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom', labels: { usePointStyle: true, font: { size: 10 } } },
                    tooltip: {
                        callbacks: {
                            title: function(tooltipItems) {
                                const item = tooltipItems[0];
                                let label = item.chart.data.labels[item.dataIndex];
                                return Array.isArray(label) ? label.join(' ') : label;
                            }
                        }
                    }
                }
            }
        });

        // --- 2. Volume Attributes Class Line Chart ---
        const ctxAttributes = document.getElementById('attributesChart').getContext('2d');
        new Chart(ctxAttributes, {
            type: 'line',
            data: {
                labels: ['08:00', '10:00', '12:00', '14:00', '16:00'],
                datasets: [
                    {
                        label: 'IOPS Limit',
                        data: [3000, 3000, 10000, 10000, 3000], 
                        borderColor: '#D946EF', 
                        backgroundColor: 'rgba(217, 70, 239, 0.1)',
                        fill: true,
                        stepped: true
                    }
                ]
            },
            options: {
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true } },
                plugins: { tooltip: { callbacks: { title: args => args[0].label } } }
            }
        });
    </script>
</body>
</html>
